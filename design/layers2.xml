<!--
 * layers2.xml
 *     Demonstrates layering.
 * 
 * Author
 *     Andrew Brown <adb1413@rit.edu>
-->



<!-- Groups -->
<group name="volumes">
	<translate x="-0.5">
		<box size="1.0"/>
	</translate>
	<translate x="+0.5">
		<box size="1.0"/>
	</translate>
</group>



<!-- Make layers -->
<texture name="layer1" />
<texture name="layer2" />
	<framebuffer>
		<target link="layer1"/>
		<target link="layer2"/>
		
		<!-- Render each set of intersecting volumes -->
		<for each="intersection" in="volumes">
			<program>
				<uniform type="int" name="numberOfLayers" value="2"/>
				<shader type="fragment" file="layers-sample.frag"/>
				<intersection/>
			</program>
		</for>
	</framebuffer>
	
	<!-- Flatten all the layers to the default framebuffer -->
	<program>
		<uniform type="int" name="numberOfLayers" value="NUMBER_OF_LAYERS"/>
		<shader type="fragment" file="layers-flatten.frag"/>
		<fullscreen/>
	</program>
</texture>
</texture>
