<!--
 * intersection.xml
 * 
 * Author
 *     Andrew Brown <adb1413@rit.edu>
-->


<group name="cubes">
	<translate x="-1">
	<scale>
		<uniform type="mat4" name="MVPMatrix" as="modelviewprojection" />
		<cube name="left">
			<uniform type="vec4" name="Color" value="1 0 1 0.4" />
			<uniform type="sampler3D" name="Volume" link="bunny" />
		</cube>
	</scale>
	</translate>
	<translate x="+1">
	<scale>
		<uniform type="mat4" name="MVPMatrix" as="modelviewprojection" />
		<cube name="right">
			<uniform type="vec4" name="Color" value="0 1 1 0.4" />
			<uniform type="sampler3D" name="Volume" link="head" />
		</cube>
	</scale>
	</translate>
</group>



<texture name="bunny" file="../textures/bunny128.vlb">
<texture name="head" file="../textures/head128.vlb">
	<texture name="end_coords" size="512">
		<program>
			<shader file="coordinates.vert" />
			<shader file="coordinates.frag" />
			
			<!-- Pieces of XOR behind AND -->
<!--
			<framebuffer>
				<target link="end_coords" />
				<uniform type="mat4" name="MVPMatrix" as="modelviewprojection" />
				<boolean operation="XOR" of="cubes" take="left" />
			</framebuffer>
-->
			<program>
				<shader file="basic.vert" />
				<shader file="basic.frag" />
				<uniform type="mat4" name="MVMatrix" as="modelview" />
				<uniform type="mat4" name="MVPMatrix" as="modelviewprojection" />
				<uniform type="mat4" name="NormalMatrix" as="normal" />
				<uniform type="vec3" name="LightPosition" value="15 15 15" />
				<uniform type="float" name="Ambient" value="0.2" />
				<boolean operation="XOR" of="cubes" take="left" />
			</program>
			
			<!-- AND -->
<!--
			<framebuffer>
				<target link="end_coords" />
				<uniform type="mat4" name="MVPMatrix" as="modelviewprojection" />
				<boolean operation="AND" of="cubes" />
			</framebuffer>
			<program>
				<shader file="intersection.vert" />
				<shader file="intersection.frag" />
				<uniform type="sampler2D" name="EndCoords0" link="end_coords" />
				<cull faces="front">
					<uniform type="mat4" name="MVPMatrix" as="modelviewprojection" />
					<boolean operation="AND" of="cubes" />
				</cull>
			</program>
-->
			
			<!-- Outlines -->
			<program>
				<shader file="color.vert" />
				<shader file="color.frag" />
				<wireframe faces="front">
					<instance of="cubes" />
				</wireframe>
			</program>
			
		</program>
	</texture>
</texture>
</texture>
